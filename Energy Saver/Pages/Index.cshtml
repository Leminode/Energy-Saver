@page
@using System.ComponentModel
@using Microsoft.AspNetCore.Mvc.ModelBinding
@using System.Reflection
@model IndexModel
@{
    ViewData["Title"] = "Home page";
}

<div class="text-center">
    <h1 class="display-4 text-color">Energy Saver</h1>
</div>
<div class="main-div">
    @if(User.Identity.IsAuthenticated){
        <table class="table" id="tax-list">
            <thead>
                <tr>
                    <th style="text-align:left">Month</th>
                    <th style="text-align:right">Gas amount</th>
                    <th style="text-align:right">Electricity amount</th>
                    <th style="text-align:right">Water amount</th>
                    <th style="text-align:right">Heating amount</th>
                    <th> </th>
                </tr>
            </thead>
            @{
                int yearIndex = 0;
            }
            @foreach (var year in Model.Taxes)
            {
                <tr>
                    <td colspan=6 style="text-align:left"><b>@year[0].Year</b></td>
                </tr>

                int index = 0;
                @foreach (var taxRecord in year)
                {
                    <tr>
                        <td style="text-align:left">@taxRecord.Month.ToString()</td>
                        <td style="text-align:right">
                            @(
                                taxRecord.GasAmount % 1 == 0 ? (int)taxRecord.GasAmount : taxRecord.GasAmount)
                        </td>
                        <td style="text-align:right">
                            @(
                                taxRecord.ElectricityAmount % 1 == 0 ? (int)taxRecord.ElectricityAmount : taxRecord.ElectricityAmount)
                        </td>
                        <td style="text-align:right">
                            @(
                                taxRecord.WaterAmount % 1 == 0 ? (int)taxRecord.WaterAmount : taxRecord.WaterAmount)
                        </td>
                        <td style="text-align:right">
                            @(
                                taxRecord.HeatingAmount % 1 == 0 ? (int)taxRecord.HeatingAmount : taxRecord.HeatingAmount)
                        </td>
                        <td style="text-align:right">
                            @if (User.Identity.IsAuthenticated)
                            {
                                <form asp-page-handler="delete" method="post">
                                    <button class="btn btn-default btn-sm text-color">Delete</button>
                                    <input type="hidden" name="index" value="@index" />
                                    <input type="hidden" name="yearIndex" value="@yearIndex" />
                                </form>
                            }
                        </td>
                        @{
                            index++;
                        }
                    </tr>
                }
                yearIndex++;
            }
        </table>
        <body>
            <div>
                @{
                    string[] comparisonString = new string[4];

                    comparisonString[0] = Model.taxComparison.GasAmount >= 0 ? "higher" : "lower";
                    comparisonString[1] = Model.taxComparison.ElectricityAmount >= 0 ? "higher" : "lower";
                    comparisonString[2] = Model.taxComparison.WaterAmount >= 0 ? "higher" : "lower";
                    comparisonString[3] = Model.taxComparison.HeatingAmount >= 0 ? "higher" : "lower";
                }
                <p class="text-color" style="margin-top: 40px">Total gas consumption this month is <span class="@(comparisonString[0] == "higher" ? "text-negative" : "text-positive")">@Math.Abs(Model.taxComparison.GasAmount)%</span> @comparisonString[0] than last month</p>

                <p class="text-color" style="margin-top: 40px">Total electricity consumption this month is <span class="@(comparisonString[1] == "higher" ? "text-negative" : "text-positive")">@Math.Abs(Model.taxComparison.ElectricityAmount)%</span> @comparisonString[1] than last month</p>

                <p class="text-color" style="margin-top: 40px">Total water consumption this month is <span class="@(comparisonString[2] == "higher" ? "text-negative" : "text-positive")">@Math.Abs(Model.taxComparison.WaterAmount)%</span> @comparisonString[2] than last month</p>

                <p class="text-color" style="margin-top: 40px">Total heating consumption this month is <span class="@(comparisonString[3] == "higher" ? "text-negative" : "text-positive")">@Math.Abs(Model.taxComparison.HeatingAmount)%</span> @comparisonString[3] than last month</p>
            </div>
        </body>
    }
    else
    {
        <body>
            <div>
                <p class="text-color" style="text-align:center">Please log in or sign up to see tax history</p>
            </div>
        </body>
    }
</div>