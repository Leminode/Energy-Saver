@page
@using System.ComponentModel
@using Microsoft.AspNetCore.Mvc.ModelBinding
@using System.Reflection
@model IndexModel
@{
    ViewData["Title"] = "Home page";
}

<div class="text-center">
    <h1 class="display-4 text-color">Energy Saver</h1>
</div>
<div class="main-div">
    @if(User.Identity.IsAuthenticated){
        <table class="table" id="tax-list">
            <thead>
                <tr>
                    <th style="text-align:left">Month</th>
                    <th style="text-align:right">Gas amount</th>
                    <th style="text-align:right">Electricity amount</th>
                    <th style="text-align:right">Water amount</th>
                    <th style="text-align:right">Heating amount</th>
                    <th> </th>
                </tr>
            </thead>
            @{
                int yearIndex = 0;
            }
            @foreach (var year in Model.Taxes)
            {
                <tr>
                    <td colspan=6 style="text-align:left"><b>@year[0].Year</b></td>
                </tr>

                int index = 0;
                @foreach (var taxRecord in year)
                {
                    <tr>
                        <td style="text-align:left">@taxRecord.Month.ToString()</td>
                        <td style="text-align:right">
                            @(
                                taxRecord.GasAmount % 1 == 0 ? (int)taxRecord.GasAmount : taxRecord.GasAmount)
                        </td>
                        <td style="text-align:right">
                            @(
                                taxRecord.ElectricityAmount % 1 == 0 ? (int)taxRecord.ElectricityAmount : taxRecord.ElectricityAmount)
                        </td>
                        <td style="text-align:right">
                            @(
                                taxRecord.WaterAmount % 1 == 0 ? (int)taxRecord.WaterAmount : taxRecord.WaterAmount)
                        </td>
                        <td style="text-align:right">
                            @(
                                taxRecord.HeatingAmount % 1 == 0 ? (int)taxRecord.HeatingAmount : taxRecord.HeatingAmount)
                        </td>
                        <td style="text-align:right">
                            @if (User.Identity.IsAuthenticated)
                            {
                                <form asp-page-handler="delete" method="post">
                                    <button class="btn btn-default btn-sm text-color">Delete</button>
                                    <input type="hidden" name="index" value="@index" />
                                    <input type="hidden" name="yearIndex" value="@yearIndex" />
                                </form>
                            }
                        </td>
                        @{
                            index++;
                        }
                    </tr>
                }
                yearIndex++;
            }
        </table>
        <body>
            <div>
                @{
                    List<string> taxList = new List<string> { "Gas", "Electricity", "Water", "Heating" };

                    taxList.Add("Gas");
                    taxList.Add("Electricity");
                    taxList.Add("Water");
                    taxList.Add("Heating");
                }
                @for(int i = 0; i < Model.taxComparison.Count(); i++)
                {
                    if(Model.taxComparison[i] > 0)
                    {
                        <p class="text-color" style="margin-top: 40px">@taxList[i] consumption this month compared to last month: <span class="text-negative")">+@Model.taxComparison[i]%</span></p>
                    }
                    else
                    {
                        <p class="text-color" style="margin-top: 40px">@taxList[i] consumption this month compared to last month: <span class="text-positive")">@Model.taxComparison[i]%</span></p>
                    }
                    
                }
            </div>
        </body>
    }
    else
    {
        <body>
            <div>
                <p class="text-color" style="text-align:center">Please log in or sign up to see tax history</p>
            </div>
        </body>
    }
</div>